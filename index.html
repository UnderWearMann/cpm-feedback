<!DOCTYPE html>
<html>
<head>
    <title>Google Sheet Search</title>
    <style>
        /* ... (Your existing CSS) ... */
        .submit-button {
            padding: 5px 10px;
            margin-left: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <script>
        // ... (Your existing searchSheet and displayResults functions) ...

        function displayResults(results, headers) {
            // ... (Your existing displayResults function) ...

            results.forEach(row => {
                const newRow = resultsTableBody.insertRow();
                row.forEach((cell, index) => {
                    const newCell = newRow.insertCell();
                    newCell.textContent = cell;
                    if (index === 0) {
                        newCell.classList.add('hidden-column');
                    }
                    if (index === headers.length - 1) {
                        const input = document.createElement("input");
                        input.type = "text";
                        input.className = "user-input";
                        input.dataset.oppId = row[0];
                        newCell.appendChild(input);

                        const submitButton = document.createElement("button");
                        submitButton.textContent = "Submit";
                        submitButton.className = "submit-button";
                        submitButton.dataset.oppId = row[0];
                        newCell.appendChild(submitButton);
                    }
                });
            });
        }

        document.getElementById('results').addEventListener('click', function (event) {
            if (event.target.classList.contains('submit-button')) {
                const submitButton = event.target;
                const oppId = submitButton.dataset.oppId;
                const inputElement = submitButton.previousElementSibling;
                const userInput = inputElement.value;
                sendDataToSheet(oppId, userInput);
            }
        });

        function sendDataToSheet(oppId, userInput) {
            console.log("Sending Opp ID:", oppId, "and User Input:", userInput); // Confirmation log
            const scriptURL = "https://script.google.com/macros/s/AKfycbz9xrkScAZh4y-5ujeY7q8LPEpYVn4XmG3Ha8iC4GwFuOZoue65ColPVLvKWkb5llcHCQ/exec";

            fetch(scriptURL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    "oppId": oppId,
                    "userInput": userInput
                })
            })
                .then(response => response.json())
                .then(data => {
                    console.log("Response from Google Apps Script:", data); // Confirmation log
                    if (data.result === "success") {
                        console.log("Data updated successfully!");
                    } else {
                        console.error("Error updating data:", data.message);
                    }
                })
                .catch(error => {
                    console.error('Error sending data:', error);
                });
        }
    </script>
</body>
</html>
